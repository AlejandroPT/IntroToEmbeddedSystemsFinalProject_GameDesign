// SpaceInvaders.c
// Runs on LM4F120/TM4C123
// Jonathan Valvano and Daniel Valvano
// This is a starter project for the EE319K Lab 10

// Last Modified: 3/6/2015 
// http://www.spaceinvaders.de/
// sounds at http://www.classicgaming.cc/classics/spaceinvaders/sounds.php
// http://www.classicgaming.cc/classics/spaceinvaders/playguide.php
/* This example accompanies the books
   "Embedded Systems: Real Time Interfacing to Arm Cortex M Microcontrollers",
   ISBN: 978-1463590154, Jonathan Valvano, copyright (c) 2014

   "Embedded Systems: Introduction to Arm Cortex M Microcontrollers",
   ISBN: 978-1469998749, Jonathan Valvano, copyright (c) 2014

 Copyright 2015 by Jonathan W. Valvano, valvano@mail.utexas.edu
    You may use, edit, run or distribute this file
    as long as the above copyright notice remains
 THIS SOFTWARE IS PROVIDED "AS IS".  NO WARRANTIES, WHETHER EXPRESS, IMPLIED
 OR STATUTORY, INCLUDING, BUT NOT LIMITED TO, IMPLIED WARRANTIES OF
 MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE APPLY TO THIS SOFTWARE.
 VALVANO SHALL NOT, IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL, INCIDENTAL,
 OR CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.
 For more information about my classes, my research, and my books, see
 http://users.ece.utexas.edu/~valvano/
 */
// ******* Possible Hardware I/O connections*******************
// Slide pot pin 1 connected to ground
// Slide pot pin 2 connected to PE2/AIN1
// Slide pot pin 3 connected to +3.3V 
// fire button connected to PE0
// special weapon fire button connected to PE1
// 8*R resistor DAC bit 0 on PB0 (least significant bit)
// 4*R resistor DAC bit 1 on PB1
// 2*R resistor DAC bit 2 on PB2
// 1*R resistor DAC bit 3 on PB3 (most significant bit)
// LED on PB4
// LED on PB5

// Backlight (pin 10) connected to +3.3 V
// MISO (pin 9) unconnected
// SCK (pin 8) connected to PA2 (SSI0Clk)
// MOSI (pin 7) connected to PA5 (SSI0Tx)
// TFT_CS (pin 6) connected to PA3 (SSI0Fss)
// CARD_CS (pin 5) unconnected
// Data/Command (pin 4) connected to PA6 (GPIO), high for data, low for command
// RESET (pin 3) connected to PA7 (GPIO)
// VCC (pin 2) connected to +3.3 V
// Gnd (pin 1) connected to ground

#include <stdint.h>
#include "tm4c123gh6pm.h"
#include "ST7735.h"
#include "Random.h"
#include "TExaS.h"
#include "ADC.h"
#include "DAC.h"


void DisableInterrupts(void); // Disable interrupts
void EnableInterrupts(void);  // Enable interrupts
void Delay100ms(uint32_t count); // time delay in 0.1 seconds

int ADCMail;
int button1Mail;
int button2Mail;
int ADCStatus = 0;
int32_t xPlayer=0, yPlayer=155;
int Score=0;
int Enemy_Speed=30; //actual movements per seconds are 30/speed
int lives=3;
int missile_speed=2;
int missile_speed2=1;
int fire_random=10;
int enemy_position=20;
int level=1;

// *************************** Images ***************************
// enemy ship that starts at the top of the screen (arms/mouth closed)
// width=16 x height=10
const unsigned short SmallEnemy10pointA[] = {
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0xFFFF, 0x0000, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0x0000, 0xFFFF, 0x0000, 0x0000,
 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0x0000,
 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
};

// enemy ship that starts at the top of the screen (arms/mouth open)
// width=16 x height=10
const unsigned short SmallEnemy10pointB[] = {
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0x0000,
 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0x0000,
 0x0000, 0x0000, 0xFFFF, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0xFFFF, 0x0000, 0x0000,
 0x0000, 0x0000, 0xFFFF, 0x0000, 0x0000, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0x0000, 0x0000, 0xFFFF, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
};

// enemy ship that starts in the middle of the screen (arms together)
// width=16 x height=10
const unsigned short SmallEnemy20pointA[] = {
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0x0000,
 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0x0000,
 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
};

// enemy ship that starts in the middle of the screen (arms apart)
// width=16 x height=10
const unsigned short SmallEnemy20pointB[] = {
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0x0000,
 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0x0000,
 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0x0000,
 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
};



// enemy ship that starts at the bottom of the screen (arms down)
// width=16 x height=10
const unsigned short SmallEnemy30pointA[] = {
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0x0000, 0xFFFF, 0xFFFF, 0x0000, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0x0000, 0xFFFF, 0xFFFF, 0x0000, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
};

// enemy ship that starts at the bottom of the screen (arms up)
// width=16 x height=10
const unsigned short SmallEnemy30pointB[] = {
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0xFFFF, 0x0000, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0x0000, 0xFFFF, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0x0000, 0xFFFF, 0xFFFF, 0x0000, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
};

// image of the player's ship
// includes two blacked out columns on the left and right sides of the image to prevent smearing when moved 2 pixels to the left or right
// width=18 x height=8
const unsigned short PlayerShip0[] = {
 0x0000, 0x0000, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0,
 0x0000, 0x0000, 0x0000, 0x0000, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0,
 0x07E0, 0x07E0, 0x0000, 0x0000, 0x0000, 0x0000, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0,
 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0,
 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x07E0,
 0x07E0, 0x07E0, 0x07E0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x07E0, 0x07E0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,


};

// small shield floating in space to cover the player's ship from enemy fire (undamaged)
// width=18 x height=5
const unsigned short Bunker0[] = {
 0x079F, 0x079F, 0x079F, 0x079F, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x079F, 0x079F,
 0x079F, 0x079F, 0x079F, 0x079F, 0x079F, 0x079F, 0x079F, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x079F,
 0x079F, 0x079F, 0x079F, 0x079F, 0x079F, 0x079F, 0x079F, 0x079F, 0x079F, 0x079F, 0x079F, 0x079F, 0x079F, 0x079F, 0x079F, 0x079F,
 0x079F, 0x079F, 0x079F, 0x079F, 0x079F, 0x079F, 0x0000, 0x079F, 0x079F, 0x079F, 0x079F, 0x079F, 0x079F, 0x079F, 0x079F, 0x079F,
 0x079F, 0x079F, 0x079F, 0x079F, 0x079F, 0x079F, 0x079F, 0x0000, 0x0000, 0x0000, 0x079F, 0x079F, 0x079F, 0x079F, 0x079F, 0x079F,
 0x079F, 0x079F, 0x079F, 0x079F, 0x079F, 0x079F, 0x079F, 0x079F, 0x0000, 0x0000,

};



// small shield floating in space to cover the player's ship from enemy fire (undamaged)
		// width=20 x height=15
		const unsigned short Green_Bunker[] = {
		 0x0000, 0x0180, 0x0160, 0x0160, 0x01A0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0100, 0x0160,
		 0x0160, 0x0160, 0x0180, 0x0040, 0x0080, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
		 0x0000, 0x0000, 0x0620, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x0280, 0x0060, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x0480, 0x0000, 0x0000,
		 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x01E0, 0x0760, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x0240, 0x0060, 0x07E0, 0x07E0, 0x07E0,
		 0x07E0, 0x07E0, 0x04A0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0160, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x0240,
		 0x0060, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0,
		 0x07E0, 0x07E0, 0x07E0, 0x0240, 0x0060, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0,
		 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x0240, 0x0060, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0,
		 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x0240, 0x0060, 0x07E0, 0x07E0, 0x07E0,
		 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x0240,
		 0x0060, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0,
		 0x07E0, 0x07E0, 0x07E0, 0x0240, 0x0060, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0,
		 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x0260, 0x0040, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0,
		 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x01E0, 0x0000, 0x00C0, 0x0740, 0x07E0,
		 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x0240, 0x0000,
		 0x0000, 0x0000, 0x0100, 0x0740, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0,
		 0x07E0, 0x0220, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0140, 0x01A0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x07E0,
		 0x07E0, 0x07E0, 0x07E0, 0x07E0, 0x0140, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0080, 0x0060, 0x0060,
		 0x0060, 0x0060, 0x0060, 0x0060, 0x0060, 0x0060, 0x0060, 0x0080, 0x0000, 0x0000, 0x0000, 0x0000,

		};







		const unsigned short Yellow_Bunker[] = {
		 0x0000, 0x0186, 0x0165, 0x0165, 0x01A6, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0104, 0x0165,
		 0x0165, 0x0165, 0x0186, 0x0041, 0x0082, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
		 0x0000, 0x0000, 0x0638, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x028A, 0x0061, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x0492, 0x0000, 0x0000,
		 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x01E7, 0x077D, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x0249, 0x0061, 0x07FF, 0x07FF, 0x07FF,
		 0x07FF, 0x07FF, 0x04B2, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0165, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x0249,
		 0x0061, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF,
		 0x07FF, 0x07FF, 0x07FF, 0x0249, 0x0061, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF,
		 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x0249, 0x0061, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF,
		 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x0249, 0x0061, 0x07FF, 0x07FF, 0x07FF,
		 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x0249,
		 0x0061, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF,
		 0x07FF, 0x07FF, 0x07FF, 0x0249, 0x0061, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF,
		 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x0269, 0x0041, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF,
		 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x01E7, 0x0000, 0x00C3, 0x075D, 0x07FF,
		 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x0249, 0x0000,
		 0x0000, 0x0000, 0x0104, 0x075D, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF,
		 0x07FF, 0x0228, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0145, 0x01A6, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x07FF,
		 0x07FF, 0x07FF, 0x07FF, 0x07FF, 0x0145, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0082, 0x0061, 0x0061,
		 0x0061, 0x0061, 0x0061, 0x0061, 0x0061, 0x0061, 0x0061, 0x0082, 0x0000, 0x0000, 0x0000, 0x0000,

		};



		const unsigned short Red_Bunker[] = {
		 0x0000, 0x0025, 0x0025, 0x0025, 0x0026, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0003, 0x0025,
		 0x0025, 0x0025, 0x0025, 0x0001, 0x0001, 0x291F, 0x20FF, 0x20FF, 0x291F, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
		 0x0000, 0x0000, 0x18B6, 0x28FF, 0x20FF, 0x20FF, 0x291F, 0x0849, 0x0001, 0x20FF, 0x20FD, 0x20FD, 0x20FF, 0x1070, 0x0000, 0x0000,
		 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0827, 0x20DB, 0x20FE, 0x20FD, 0x20FD, 0x20FF, 0x0828, 0x0001, 0x20FF, 0x20FD, 0x20FD,
		 0x20FD, 0x20FF, 0x1091, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0025, 0x20FD, 0x20FE, 0x20FD, 0x20FD, 0x20FD, 0x20FF, 0x0828,
		 0x0001, 0x20FF, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FE, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FE, 0x20FE, 0x20FD, 0x20FD,
		 0x20FD, 0x20FD, 0x20FF, 0x0828, 0x0001, 0x20FF, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD,
		 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FF, 0x0828, 0x0001, 0x20FF, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD,
		 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FF, 0x0828, 0x0001, 0x20FF, 0x20FD, 0x20FD,
		 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FF, 0x0828,
		 0x0001, 0x20FF, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD,
		 0x20FD, 0x20FD, 0x20FF, 0x0828, 0x0001, 0x28FF, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD,
		 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FF, 0x0828, 0x0001, 0x20FD, 0x20FE, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD,
		 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FE, 0x20FE, 0x0827, 0x0000, 0x0002, 0x20DB, 0x20FF,
		 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FE, 0x20DD, 0x0848, 0x0000,
		 0x0000, 0x0000, 0x0004, 0x20DA, 0x20FF, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD, 0x20FD,
		 0x20FF, 0x0827, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0024, 0x0026, 0x291F, 0x20FF, 0x20FF, 0x20FF, 0x20FF, 0x20FF, 0x20FF,
		 0x20FF, 0x20FF, 0x20FF, 0x291F, 0x0024, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0002, 0x0001, 0x0001,
		 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0002, 0x0000, 0x0000, 0x0000, 0x0000,

		};


		const unsigned short Black_Bunker[] = {
		 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
		 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
		 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
		 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
		 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
		 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
		 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
		 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
		 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
		 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
		 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
		 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
		 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
		 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
		 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
		 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
		 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
		 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
		 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,

		};
		typedef struct State STyp;
		struct BunkerState{
			unsigned long xb;
			unsigned long yb;
			const unsigned short *imageb[4];
			int blife;};
			
			

		 typedef struct BunkerState STy;

		STy Bunker[3]={
			{13, 135, {Red_Bunker, Yellow_Bunker, Green_Bunker},3},
			{54, 135, {Red_Bunker, Yellow_Bunker, Green_Bunker},3},
			{90, 135, {Red_Bunker, Yellow_Bunker, Green_Bunker},3}};


	void Draw_Bunker(void){
			for (int b =0; b<3;b++){
				if (Bunker[b].blife == 0){
					ST7735_DrawBitmap(Bunker[b].xb, Bunker[b].yb, Black_Bunker, 20,15);
				}else {
						ST7735_DrawBitmap(Bunker[b].xb, Bunker[b].yb, Bunker[b].imageb[Bunker[b].blife-1], 20,15);
				}
					
			}
		}
			//
// *************************** Capture image dimensions out of BMP**********
//Laser from Player
//width = 4 height = 10
const unsigned short Laser0[] = {
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x4D84, 0x4D84, 0x0000, 0x0000, 0x4D84, 0x4D84, 0x0000, 0x0000, 0x4D84, 0x4D84, 0x0000,
 0x0000, 0x4D84, 0x4D84, 0x0000, 0x0000, 0x4D84, 0x4D84, 0x0000, 0x0000, 0x4D84, 0x4D84, 0x0000, 0x0000, 0x4D84, 0x4D84, 0x0000,
 0x0000, 0x4D84, 0x4D84, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
};
//
const unsigned short Missile0[] = {
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0x0000, 0xFFFF, 0x0000, 0x0000, 0x0000, 0xFFFF, 0x0000, 0x0000,
 0x0000, 0xFFFF, 0x0000, 0xFFFF, 0x0000, 0xFFFF, 0x0000, 0x0000, 0x0000, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000,
};

//
void SysTick_Init(void){
	NVIC_ST_CTRL_R = 0; 				  // 1. disable Systick while setting up
	NVIC_ST_RELOAD_R = 2666666-1; 	// 2. period a.k.a frequency determined by equation 
	NVIC_ST_CURRENT_R = 0;				// 3. clear current state
	NVIC_SYS_PRI3_R = (NVIC_SYS_PRI3_R&0x00FFFFFF) | 0x20000000; // 4. priority set to 1
	NVIC_ST_CTRL_R = 0x0007; 			// 4. reanable Systick with clock and interrupts
}
//
uint32_t button1(void){
	return (GPIO_PORTF_DATA_R&0x10);
}

uint32_t button2(void){
	return (GPIO_PORTF_DATA_R&0x04);
}
//
struct State{
	unsigned long x;
	unsigned long y;
	const unsigned short *image;
	int life;
};
typedef struct State STyp;

STyp Enemy[15]={
	{0 ,20, SmallEnemy30pointA, 1},
	{20 ,20, SmallEnemy30pointA, 1},
	{40 ,20, SmallEnemy30pointA, 1},
	{60 ,20, SmallEnemy30pointA, 1},
	{80 ,20, SmallEnemy30pointA, 1},
	
	{0 ,40, SmallEnemy20pointA, 1},
	{20 ,40, SmallEnemy20pointA, 1},
	{40 ,40, SmallEnemy20pointA, 1},
	{60 ,40, SmallEnemy20pointA, 1},
	{80 ,40, SmallEnemy20pointA, 1},

	{0 ,60, SmallEnemy10pointA, 1},
	{20 ,60, SmallEnemy10pointA, 1},
	{40 ,60, SmallEnemy10pointA, 1},
	{60 ,60, SmallEnemy10pointA, 1},
	{80 ,60, SmallEnemy10pointA, 1}
};
//
void Draw_Enemy(void){
	for(int i=0; i<15;i++){
		if(Enemy[i].life)
			ST7735_DrawBitmap(Enemy[i].x, Enemy[i].y, Enemy[i].image, 16,10);
	}
}
//
void Move_Enemy(void){
	static int count =0; //so that the enemy move once a second
	static int right =1;	//to know what direction the enemies are moving
	static int A=1;			// to know whether enemy image A or B
	count++;
	if(count>=Enemy_Speed){    //check if the second is up
		if(right){			//if it is moving right
			for(int i=0;i<15;i++)
				Enemy[i].x++;
		}
		else{					//if it is moving left
			for(int i=0;i<15;i++)
				Enemy[i].x--;
		}
		if(Enemy[4].x>=110){//check to see if the enemies are at the right border
			right=0;
			for(int i=0;i<15;i++)
				Enemy[i].y++;
		}
		if(Enemy[0].x<=2||Enemy[0].x>=200){//check to see if the enemies are at the left border
			right=1;
			for(int i=0;i<15;i++)
				Enemy[i].y++;
		}
		if(A){	//change the enemies' image from B to A
			for(int i=0;i<5;i++)
				Enemy[i].image=SmallEnemy30pointA;
			for(int i=5;i<10;i++)
				Enemy[i].image=SmallEnemy20pointA;
			for(int i=10;i<15;i++)
				Enemy[i].image=SmallEnemy10pointA;
			A=0;
		}
		else{  //change the enemies' image from A to B
			for(int i=0;i<5;i++)
				Enemy[i].image=SmallEnemy30pointB;
			for(int i=5;i<10;i++)
				Enemy[i].image=SmallEnemy20pointB;
			for(int i=10;i<15;i++)
				Enemy[i].image=SmallEnemy10pointB;
			A=1;
		}
		count=0;
	}
}
//
void LevelUp(void){
	for(int i=0;i<5;i++){//restart values for enemies on top line
		Enemy[i].x=i*20;
		Enemy[i].y=enemy_position;
		Enemy[i].life=1;
	}
	for(int i=5;i<10;i++){//restart values for enemies on middle line
		Enemy[i].x=(i-5)*20;
		Enemy[i].y=enemy_position+20;
		Enemy[i].life=1;
	}
	for(int i=10;i<15;i++){//restart values for enemies on bottom line
		Enemy[i].x=(i-10)*20;
		Enemy[i].y=enemy_position+40;
		Enemy[i].life=1;
	}
	if(Enemy_Speed!=5)//increase speed of enemies
		Enemy_Speed-=5;
	if(Score>=300)
		missile_speed=1;
	if(Score>=900)
		missile_speed2=2;
	if(fire_random>=3)
		fire_random-=2;
	if(enemy_position<=130)
		enemy_position+=10;
	level++;
}
//
STyp Laser = {60,145,Laser0,0};
void Player_Fire(){
	Laser.x=xPlayer+7;//draw initial laser at center of player
	Laser.life=1;			//give life to laser
	Laser.y=145;			//set it at the base, just on top of player
	ST7735_DrawBitmap(Laser.x, Laser.y, Laser.image, 4,10);
	Sound_Shoot();
}
//
		void Move_Laser(void){
			int topY=Laser.y-9;
			static int count=0;
			for(int i=0;i<15;i++){
				if(Enemy[i].life){
					if(topY <= Enemy[i].y && topY >= Enemy[i].y-9){ //check if collition with Y of enemy
						if(Laser.x>=Enemy[i].x && Laser.x<=Enemy[i].x+15){ //check if collition w/ x of enemy
							Enemy[i].life=0; //kill enemy
							Laser.life=0;			//kill laser
							ST7735_FillRect(Laser.x, Laser.y-10, 4, 10, 0x0000); //erase laser
							ST7735_FillRect(Enemy[i].x, Enemy[i].y-8, 16, 10, 0x0000); //erase enemy
							Laser.y=145;	//reset laser value
							if(i<5)//asign scores depending on enemy killed, 30 for top, 20 mid, 10 buttom
								Score+=30;
							else if(i<10)
								Score+=20;
							else 
								Score+=10;
							if(Score%300==0)
								LevelUp();
							return;
						}
					}
				}
			}
				for(int i=0; i<3;i++){
				if(Bunker[i].blife!=0){
					if(Laser.x>=Bunker[i].xb && Laser.x<=Bunker[i].xb+20){
						if(Laser.y <= 135){
							ST7735_FillRect(Laser.x, Laser.y-10, 4, 10, 0x0000);
							Bunker[i].blife = Bunker[i].blife-1;
							Laser.y=0;
							if(Bunker[i].blife == 0){
								ST7735_FillRect(Laser.x, Laser.y-10, 30, 30, 0x0000);
								Bunker[i].blife = 0;
							}
							
						}
					}
				}
			}
			if(Laser.y<=0){//check if laser out of bounds, and if so, kill it
				Laser.life=0;
				Laser.y=145;
			}
			if(count>=1){//move laser every cycle(30hz)
				Laser.y--;
				count=0;
			}
			count++;
		}
		//

void Draw_Laser(void){
		ST7735_DrawBitmap(Laser.x, Laser.y, Laser.image, 4,10);
}
//
STyp Missiles[5]={
	{0 ,10, Missile0, 0},
	{20 ,10, Missile0, 0},
	{40 ,10, Missile0, 0},
	{60 ,10, Missile0, 0},
	{80 ,10, Missile0, 0},
};
void Enemy_Fire(void){
	static int count=0;
	if(count>=100){
		int will_fire = Random()%fire_random;//fires only when 0
		int who_fire;
		int missile=5;
		for(int i=0;i<5;i++){
			if(!Missiles[i].life)
				missile=i;
		}
		if(!will_fire&&missile!=5){
			who_fire = Random()%5;
			who_fire+=10;
			if(!Enemy[who_fire].life){
				who_fire-=5;
				if(!Enemy[who_fire].life){
					who_fire-=5;
					if(!Enemy[who_fire].life)
						will_fire=1;
				}
			}
			if(!will_fire){
				Missiles[missile].life=1;
				Missiles[missile].x=Enemy[who_fire].x+6;
				Missiles[missile].y=Enemy[who_fire].y+11;
				ST7735_DrawBitmap(Missiles[missile].x, Missiles[missile].y, Missiles[missile].image, 3,11);
			}
		}
		count=0;
	}
	count++;
}
//
	void Move_Missile(void){
			static int count=0;
				for(int i=0;i<5;i++){
					if(Missiles[i].life){
							for (int m=0; m<3; m++){
								if(Bunker[m].blife!=0){
									if(Missiles[i].x>= Bunker[m].xb-1&&Missiles[i].x<=Bunker[m].xb+20){
										if(Missiles[i].y >= 127&& Missiles[i].y<=135){
											Bunker[m].blife = Bunker[m].blife-1;
											ST7735_FillRect(Missiles[i].x-1, Missiles[i].y-12, 4, 11, 0x0000);
											Missiles[i].y=0;
											Missiles[i].life=0;								
										}
									}
								}
							}
						if(Missiles[i].y>=147){
							if(Missiles[i].x>=xPlayer&&Missiles[i].x<=xPlayer+18){
								lives--;
								ST7735_FillRect(Missiles[i].x-1, Missiles[i].y-12, 4, 11, 0x0000);
								Missiles[i].life=0;
								Missiles[i].y=0;
							}
							if(Missiles[i].y>=170){
								Missiles[i].life=0;
								Missiles[i].y=0;
							}

							}
						}
				}
			if(count>=missile_speed){//move laser every cycle(30hz)
				for(int i=0;i<5;i++)
					Missiles[i].y+=missile_speed2;
				count=0;
			}
			count++;
			
				
			
		}
		//
void Draw_Missile(void){
	for(int i=0;i<5;i++){
		if(Missiles[i].life)
			ST7735_DrawBitmap(Missiles[i].x, Missiles[i].y, Missiles[i].image, 3,11);
	}
}
//
void SysTick_Handler(void){
	ADCMail = ADC_In();	//get ADC
	button1Mail= button1(); //get Button
	button2Mail= button2(); //get Button
	Move_Enemy();	
	Move_Missile();
	ADCStatus = 1;				//set status
					
	IO_HeartBeat();
	//Enemy_Fire();
	return;
}
//
int main(void){
  TExaS_Init();  // set system clock to 80 MHz
	DAC_Init();
  Random_Init(1);
	ADC_Init();
	SysTick_Init();
	
  Output_Init();
	IO_Init();
	
	Timer0_Init(7273);
  ST7735_FillScreen(0x0000);            // set screen to black
  while(lives){
		if(button2Mail){
			ST7735_FillScreen(0x0000); 
			ST7735_SetCursor(5,5);
			ST7735_OutString("Paused ");
			Delay100ms(5);
			while(!button2Mail){
				
			}
			Delay100ms(2);
			ST7735_FillScreen(0x0000); 
		}
		Draw_Enemy();
		Draw_Missile();
		Draw_Bunker();
		int ADC= ADCMail;
		xPlayer=ADC*(112)/4098;
		ST7735_FillRect(0, 155-7, 160, 8, 0x0000);
		ST7735_DrawBitmap(xPlayer, yPlayer, PlayerShip0, 18,8);
		if(button1Mail&&!Laser.life)
			Player_Fire();
		if(Laser.life){
			Draw_Laser();
			Move_Laser();
		}
		ST7735_SetCursor(0,0);
		LCD_OutDec(Score);
		ST7735_SetCursor(5,0);
		ST7735_OutString("Lives ");
		LCD_OutDec(lives);
		ST7735_SetCursor(14,0);
		ST7735_OutString("Lvl ");
		LCD_OutDec(level);
		Enemy_Fire();
  }
	ST7735_FillScreen(0x0000);
	ST7735_SetCursor(5,5);
	ST7735_OutString("You're Dead ");
	ST7735_SetCursor(5,7);
	ST7735_OutString("Press reset ");
}


// You can use this timer only if you learn how it works

void Delay100ms(uint32_t count){uint32_t volatile time;
  while(count>0){
    time = 727240; // 0.1sec at 80 MHz
    while(time){
	  	time--;
    }
    count--;
  }
}
